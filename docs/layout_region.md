# リージョンについて

TOC:
- リージョンの概要・概念
  - リージョン
  - セル
  - グリッド
  - 映像ソース
    - 開始時刻、終了時刻、コネクション ID （分割録画の時に重要）
    - 分割録画の扱い
  - XY 座標のオリジン
  - Z 座標について
- グリッドの行列サイズの決定方法
- セルへのソースの割り当て方法
  - セルの優先度 (同一セルに複数ソースが割り当てられた場合の優先度決定)
  - cells_excluded について
- 全体の解像度の決定方法
- リージョンの解像度の決定方法
- セルの解像度の決定方法
- 枠線（ボーダー）の扱い
- trim の扱い

## リージョンの概要

**リージョン**は、Hisui の映像合成における基本的な配置単位です。
一つのリージョン内では、複数の映像ソースを格子状（グリッド）に配置して表示できます。

### 基本概念

#### リージョン

映像合成において、特定の位置とサイズを持つ映像表示領域です。各リージョンは以下の属性を持ちます：
- **位置**: X 座標、Y 座標で指定される配置位置
- **サイズ**: 幅と高さ（ピクセル単位）
- **重ね順**: Z 座標による前後関係の指定
- **映像ソース一覧**: そのリージョンに表示する映像ファイルの指定

#### セル

リージョン内のグリッドを構成する個々の区画です。
各セルには一つの映像ソースが割り当てられ、映像が表示されます。
セルのサイズは、リージョンのサイズとグリッドの行列数から自動的に計算されます。

#### グリッド

リージョン内でのセルの配置パターンです。
行数と列数で構成され、映像ソースの数や `max_rows`、`max_columns` の設定に基づいて自動的に決定されます。

#### 映像ソース

実際に表示される映像データです。
各映像ソースには以下の情報が含まれます：
- **コネクション ID**: 配信者を識別するための ID（分割録画の際に重要）
- **開始時刻・終了時刻**: 映像が表示される時間範囲
- **分割録画の扱い**: 同一コネクション ID の複数ファイルは自動的に連結して処理されます

#### XY 座標のオリジン

座標系の原点は画面の**左上角**です。
X 座標は右方向、Y 座標は下方向が正の値となります。

#### Z 座標の扱い

Z 座標は、複数のリージョンが重なり合う場合の描画順序を決定します。
値が小さいリージョンほど奥（背景側）に、値が大きいリージョンほど手前（前景側）に描画されます。

### 複数リージョンの利用例

複数のリージョンを組み合わせることで、Picture-in-Picture のような複雑なレイアウトを実現できます：

```json
{
  "video_layout": {
    "main": {
      "video_sources": ["presenter.json"],
      "width": 1280, "height": 720,
      "x_pos": 0, "y_pos": 0, "z_pos": 0
    },
    "participants": {
      "video_sources": ["participant-*.json"],
      "max_columns": 4, "max_rows": 1,
      "width": 640, "height": 120,
      "x_pos": 320, "y_pos": 580, "z_pos": 10
    }
  }
}
```

この例では、`main` リージョンで発表者の映像を大きく表示し、`participants` リージョンで参加者の映像を小さく重ね合わせて表示しています。
